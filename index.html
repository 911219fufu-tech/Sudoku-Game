
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoku - Game</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="main-flex-container">
        <div class="difficulty-menu">
            <h1 class="menu-title">Sudoku - Game</h1>
            <div class="difficulty-buttons">
                <button class="difficulty-btn" data-diff="easy">Easy</button>
                <button class="difficulty-btn" data-diff="medium">Medium</button>
                <button class="difficulty-btn" data-diff="hard">Hard</button>
            </div>
        </div>
        <div class="sudoku-panel">
            <!-- Sudoku grid area, initially hidden, shown after JS loads -->
            <div class="sudoku-container" id="sudoku-container"></div>
            <div class="number-pad" id="number-pad"></div>
            <div class="sudoku-actions" id="sudoku-actions">
                <button onclick="window.newGame && window.newGame()" id="new-game-btn">New Game</button>
                <button onclick="checkSolution()">Check Solution</button>
                <button onclick="showSolution()">Show Solution</button>
            </div>
        </div>
        <div class="score-panel" id="score-panel">
            <div class="score-title">Score</div>
            <div class="score-value" id="score-value">--</div>
            <div class="timer-title">Time</div>
            <div class="timer-value" id="timer-value">00:00</div>
        </div>
    </div>
    <script src="sudoku.js"></script>
    <script>
    // Animation for switching views
    const mainContainer = document.querySelector('.main-flex-container');
    const menu = document.querySelector('.difficulty-menu');
    const sudokuPanel = document.querySelector('.sudoku-panel');
    const diffBtns = document.querySelectorAll('.difficulty-btn');
    sudokuPanel.style.display = 'none';
    diffBtns.forEach(btn => {
        btn.onclick = function() {
            // Remove selected style from all buttons
            diffBtns.forEach(b => b.classList.remove('selected'));
            // Highlight only the selected button
            btn.classList.add('selected');
            mainContainer.classList.add('is-playing');
            menu.classList.add('slide-left');
            sudokuPanel.style.display = 'flex';
            setTimeout(() => {
                sudokuPanel.classList.add('slide-in');
            }, 50);
            // Load puzzle for selected difficulty
            loadSudoku(btn.dataset.diff);
        };
    });
    // Score display
    window.updateScore = function(score) {
        document.getElementById('score-value').textContent = score;
        // Stop timer if score is a number (not '--')
        if (score && score !== '--') {
            if (typeof window.stopTimer === 'function') window.stopTimer();
        }
    }

    // Timer logic
    let timerInterval = null;
    let timerSeconds = 0;
    function updateTimerDisplay() {
        const min = String(Math.floor(timerSeconds / 60)).padStart(2, '0');
        const sec = String(timerSeconds % 60).padStart(2, '0');
        document.getElementById('timer-value').textContent = `${min}:${sec}`;
    }
    function startTimer() {
        if (timerInterval) clearInterval(timerInterval);
        timerSeconds = 0;
        updateTimerDisplay();
        timerInterval = setInterval(() => {
            timerSeconds++;
            updateTimerDisplay();
        }, 1000);
    }
    function stopTimer() {
        if (timerInterval) clearInterval(timerInterval);
        timerInterval = null;
    }
    window.stopTimer = stopTimer;

    // New Game button handler
    window.newGame = function() {
        // Find selected difficulty
        const selected = document.querySelector('.difficulty-btn.selected');
        const diff = selected ? selected.dataset.diff : 'easy';
        loadSudoku(diff);
        // Reset score display
        window.updateScore('--');
        // Always allow timer to start on New Game
        timerStopped = false;
        startTimer();
    }

    // Only start timer on first entry to game (not on repeated difficulty selection)
    let firstGameStarted = false;
    let timerStopped = false;
    diffBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            if (!firstGameStarted && sudokuPanel.style.display === 'flex') {
                startTimer();
                firstGameStarted = true;
                timerStopped = false;
            }
        });
    });

    // Patch: prevent timer from restarting on repeated difficulty selection after checkSolution
    // Only New Game or first entry can start timer
    window.stopTimer = function() {
        if (timerInterval) clearInterval(timerInterval);
        timerInterval = null;
        timerStopped = true;
    }
    // Patch: block startTimer if timerStopped is true and not from New Game
    const origStartTimer = startTimer;
    function startTimerPatched() {
        if (timerStopped) return;
        origStartTimer();
    }
    startTimer = startTimerPatched;
    </script>
</body>
</html>

